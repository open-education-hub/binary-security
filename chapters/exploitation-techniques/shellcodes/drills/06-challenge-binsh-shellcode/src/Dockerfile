# Build stage
FROM gcc:latest AS build

WORKDIR /app
COPY vuln.c .
COPY binsh_shellcode.nasm .
COPY Makefile.sol .
RUN apt-get update && apt-get install -y nasm binutils
RUN make -f Makefile.sol

# Runtime stage
FROM debian:bullseye-slim

WORKDIR /app
COPY --from=build /app/vuln .
COPY --from=build /app/binsh_shellcode.bin .

# Expose port 31344 for external connections
EXPOSE 31344

CMD ["/app/vuln"]
