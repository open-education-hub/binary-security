<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Binary Analysis/Executables and Processes/Reading/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Executables and Processes | Binary Security</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://open-education-hub.github.io/binary-security/Binary Analysis/Executables and Processes/Reading/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Executables and Processes | Binary Security"><meta data-rh="true" name="description" content="From a user&#x27;s perspective, the main purpose of the computing system is to run applications."><meta data-rh="true" property="og:description" content="From a user&#x27;s perspective, the main purpose of the computing system is to run applications."><link data-rh="true" rel="canonical" href="http://open-education-hub.github.io/binary-security/Binary Analysis/Executables and Processes/Reading/"><link data-rh="true" rel="alternate" href="http://open-education-hub.github.io/binary-security/Binary Analysis/Executables and Processes/Reading/" hreflang="en"><link data-rh="true" rel="alternate" href="http://open-education-hub.github.io/binary-security/Binary Analysis/Executables and Processes/Reading/" hreflang="x-default"><link rel="stylesheet" href="/binary-security/assets/css/styles.49519274.css">
<link rel="preload" href="/binary-security/assets/js/runtime~main.2a371c1c.js" as="script">
<link rel="preload" href="/binary-security/assets/js/main.a3ed9e3a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/binary-security/"><div class="navbar__logo"><img src="/binary-security/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/binary-security/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Binary Security</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/binary-security/Binary Analysis">Binary Analysis</a><a class="navbar__item navbar__link" href="/binary-security/Exploitation Techniques">Exploitation Techniques</a><a class="navbar__item navbar__link" href="/binary-security/Mitigation and Defensive Strategies">Mitigation and Defensive Strategies</a><a class="navbar__item navbar__link" href="/binary-security/Extra">Extra</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/binary-security/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/binary-security/Binary Analysis/">Binary Analysis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Binary Analysis&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/binary-security/Binary Analysis/Exploration Tools/">Exploration Tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Exploration Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/binary-security/Binary Analysis/Executables and Processes/">Executables and Processes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Executables and Processes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/binary-security/Binary Analysis/Executables and Processes/Reading/">Reading</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/binary-security/Binary Analysis/Executables and Processes/Drills/">Drills</a><button aria-label="Toggle the collapsible sidebar category &#x27;Drills&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/binary-security/Binary Analysis/Executables and Processes/Executables-and-Processes">Slides</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/binary-security/Binary Analysis/Static Analysis/">Static Analysis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Static Analysis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/binary-security/Binary Analysis/Dynamic Analysis/">Dynamic Analysis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Dynamic Analysis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/binary-security/Exploitation Techniques/">Exploitation Techniques</a><button aria-label="Toggle the collapsible sidebar category &#x27;Exploitation Techniques&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/binary-security/Mitigation and Defensive Strategies/">Mitigation and Defensive Strategies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mitigation and Defensive Strategies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/binary-security/Extra/">Extra</a><button aria-label="Toggle the collapsible sidebar category &#x27;Extra&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/binary-security/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/binary-security/Binary Analysis/"><span itemprop="name">Binary Analysis</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/binary-security/Binary Analysis/Executables and Processes/"><span itemprop="name">Executables and Processes</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Reading</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Executables and Processes</h1><p>From a user&#x27;s perspective, the main purpose of the computing system is to run applications.
Applications are used for the user&#x27;s benefit: listen to music, organize files, play games, develop applications, chat over the Internet, etc.</p><p>A running application is called <strong>a process</strong>.
A user starts a process, interacts with a process, ends a process.</p><p>When a process runs for the benefit of the user, it <strong>executes instructions</strong> that <strong>operate on data</strong>.
These two items (executing instructions and operating on data) are the most relevant items to understanding processes and executables.
Instructions, also called <strong>code</strong>, and <strong>data</strong> reside in memory.
Code is read from memory by the processor / CPU (<em>Central Processing Unit</em>), then it is decoded and interpreted by the CPU, then it is executed on data that is also read from memory by the CPU.
Finally, the result of the operation is stored back into memory.
So, each process has its memory space that stores code and data.</p><p>TODO: diagram with memory (code, data) and CPU interaction</p><p>We say that each process has its own memory space, also called address space.
We refer to this as <strong>process address space</strong>, or <strong>process virtual address space</strong> (<code>(P)VAS</code>) (why this is named <em>virtual</em> is outside the scope of this section).
This space is populated with data and code.
Data is dynamic with respect to contents and size: it can be modified, it can be enlarged or shrinked.
Code is static: it can&#x27;t be (easily) modified, it can&#x27;t be (easily) enlarged.
Data can be read from or written to outside the process memory, to outside devices (I/O - <em>Input/Output</em>) - keyboard, monitor, network, disk.
Code is however read at process birth time.</p><p>The origin of the code and some parts of the data is <strong>the application executable</strong> (or program executable).
The application executable is a binary file with a given format that stores the code and initial data that will be used to set up the process.
The birth of a process means loading the code and initial data from the program executable into memory.
This creates the process virtual address space.
Then the CPU is pointed to execute instructions from the new process virtual address spaces and now the process is running.</p><p>TODO: diagram with executable (code, data) and process memory (code, data) + CPU (code + data interaction) + I/O (for parts of data)</p><p>We call the starting of a process from a program executable <strong>loading</strong>.
The <strong>loader</strong> is the piece of software responsible for this.
Whatever happens during loading is said to happen during <strong>load-time</strong>.
After the process starts, whatever happens is said to happen at / during <strong>runtime</strong>.</p><p>For this session we will first look at the process virtual address space and see how it is updated at runtime.
We will then map that information to the program executable and what&#x27;s hapenning at load-time.
We will then spend more time dissecting and executable and make the first steps on static analysis, the subject of the <a href="/binary-security/Binary Analysis/Static Analysis/Reading">next section</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="process-memory-layout">Process Memory Layout<a class="hash-link" href="#process-memory-layout" title="Direct link to heading">​</a></h2><p>To understand the full picture of program execution it is vital to understand the memory layout of processes from ELF executables.
The kernel provides an interface in <code>/proc/&lt;PID&gt;/maps</code> for each process to see how the memory layout looks like.</p><p>Let&#x27;s write a simple Hello World application and investigate.</p><p><strong>IMPORTANT:</strong> Note that we have removed <strong>Address Space Layout Randomization</strong> for these examples.
We&#x27;ll explain this later.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Hello world\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ gcc -Wall hw.c -o hw -m32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ./hw  &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1] 4771</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cat /proc/4771/maps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048000-08049000 r-xp 00000000 08:06 1843771                            /tmp/hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049000-0804a000 r--p 00000000 08:06 1843771                            /tmp/hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a000-0804b000 rw-p 00001000 08:06 1843771                            /tmp/hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804b000-0806e000 rw-p 00000000 00:00 0                                  [heap]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7ded000-f7dee000 rw-p 00000000 00:00 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7dee000-f7f93000 r-xp 00000000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7f93000-f7f95000 r--p 001a5000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7f95000-f7f96000 rw-p 001a7000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7f96000-f7f99000 rw-p 00000000 00:00 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7fd9000-f7fdb000 rw-p 00000000 00:00 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7fdb000-f7fdc000 r-xp 00000000 00:00 0                                  [vdso]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7fdc000-f7ffc000 r-xp 00000000 08:06 917869                             /lib32/ld-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7ffc000-f7ffd000 r--p 0001f000 08:06 917869                             /lib32/ld-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7ffd000-f7ffe000 rw-p 00020000 08:06 917869                             /lib32/ld-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fffdd000-ffffe000 rw-p 00000000 00:00 0                                  [stack]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we start another process in the background the output for it will be exactly the same as this one.
Why is that?
The answer, of course, is virtual memory.
The kernel provides this mechanism through which each process has an address space <strong>completely isolated</strong> from that of other running processes.
They can still communicate using inter-process communication mechanisms provided by the kernel but we won&#x27;t get into that here.
Shortly put, there would be two processes with the same name and with two <strong>apparently</strong> identical mappings, but still the two programs would be isolated from one another.</p><p>An initial schematic of the memory layout would be the following:</p><p><img loading="lazy" alt="ELF Memory Layout" src="/binary-security/assets/images/elf-space-6c6f85136ae706692845144008116b7c.png" width="481" height="492" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="executable">Executable<a class="hash-link" href="#executable" title="Direct link to heading">​</a></h3><p>As we have seen, there are three memory regions associated with the executable:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">08048000-08049000 r-xp 00000000 08:06 1843771                            /tmp/hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049000-0804a000 r--p 00000000 08:06 1843771                            /tmp/hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a000-0804b000 rw-p 00001000 08:06 1843771                            /tmp/hw</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From their permissions we can infer what they correspond to:</p><ul><li><code>08048000-08049000 r-xp</code> is the <code>.text</code> section along with the rest of the executable parts</li><li><code>08049000-0804a000 r–p</code> is the <code>.rodata</code> section</li><li><code>0804a000-0804b000 rw-p</code> consists of the <code>.data</code>, <code>.bss</code> sections and other R/W sections</li></ul><p>It is interesting to note that the executable is almost identically mapped into memory.
The only region that is <em>compressed</em> in the binary is the <code>.bss</code> section.
Let&#x27;s see this in action by dumping the header of the file:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ hexdump -Cv hw | head</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000  7f 45 4c 46 01 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000010  02 00 03 00 01 00 00 00  b0 83 04 08 34 00 00 00  |............4...|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000020  78 11 00 00 00 00 00 00  34 00 20 00 0a 00 28 00  |x.......4. ...(.|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000030  1e 00 1b 00 06 00 00 00  34 00 00 00 34 80 04 08  |........4...4...|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000040  34 80 04 08 40 01 00 00  40 01 00 00 05 00 00 00  |4...@...@.......|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000050  04 00 00 00 03 00 00 00  74 01 00 00 74 81 04 08  |........t...t...|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000060  74 81 04 08 13 00 00 00  13 00 00 00 04 00 00 00  |t...............|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000070  01 00 00 00 01 00 00 00  00 00 00 00 00 80 04 08  |................|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000080  00 80 04 08 6c 06 00 00  6c 06 00 00 05 00 00 00  |....l...l.......|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000090  00 10 00 00 01 00 00 00  00 0f 00 00 00 9f 04 08  |................|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gdb ./hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gdb-peda$ hexdump 0x08048000 /10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048000 : 7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00   .ELF............</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048010 : 02 00 03 00 01 00 00 00 b0 83 04 08 34 00 00 00   ............4...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048020 : 78 11 00 00 00 00 00 00 34 00 20 00 0a 00 28 00   x.......4. ...(.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048030 : 1e 00 1b 00 06 00 00 00 34 00 00 00 34 80 04 08   ........4...4...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048040 : 34 80 04 08 40 01 00 00 40 01 00 00 05 00 00 00   4...@...@.......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048050 : 04 00 00 00 03 00 00 00 74 01 00 00 74 81 04 08   ........t...t...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048060 : 74 81 04 08 13 00 00 00 13 00 00 00 04 00 00 00   t...............</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048070 : 01 00 00 00 01 00 00 00 00 00 00 00 00 80 04 08   ................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048080 : 00 80 04 08 6c 06 00 00 6c 06 00 00 05 00 00 00   ....l...l.......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x08048090 : 00 10 00 00 01 00 00 00 00 0f 00 00 00 9f 04 08   ................</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="heap">Heap<a class="hash-link" href="#heap" title="Direct link to heading">​</a></h3><p>The heap comes right after the executable at <code>0x0804b000</code> and ends at <code>0x0806e000</code> which is the current <code>brk</code> point.
The memory allocator will increase the <code>brk</code> when more allocations are made but will not decrease it when memory is freed so as to reuse the memory regions for future allocations.
The allocator in libc actually keeps a list of past allocations and their sizes.
When future allocations will require the same size as a previously freed region, the allocator will reuse one from this lookup table.
The process is called <strong>binning</strong>.</p><p>Let&#x27;s see how the <code>brk</code> evolves in our executable using strace:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ strace -i -e brk ./hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ Process PID=1995 runs in 32 bit mode. ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[f7ff2314] brk(0)                       = 0x804b000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[f7fdb430] brk(0)                       = 0x804b000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[f7fdb430] brk(0x806e000)               = 0x806e000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s test the fact that the <code>brk</code> does not decrease and that future <code>malloc</code> calls can reuse previously freed regions:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ strace -e brk ./hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ Process PID=2424 runs in 32 bit mode. ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0)                              = 0x804b000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0)                              = 0x804b000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0x806c000)                      = 0x806c000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ exited with 0 +++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ltrace -e malloc ./hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(0)                       = 0x804b008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(100)                     = 0x804b018</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(200)                     = 0x804b080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(300)                     = 0x804b150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(400)                     = 0x804b280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(500)                     = 0x804b418</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(600)                     = 0x804b610</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(700)                     = 0x804b870</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(800)                     = 0x804bb30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(900)                     = 0x804be58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1000)                    = 0x804c1e0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1100)                    = 0x804c5d0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1200)                    = 0x804ca20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1300)                    = 0x804ced8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1400)                    = 0x804d3f0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(0)                       = 0x804b008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(100)                     = 0x804b018</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(200)                     = 0x804b080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(300)                     = 0x804b150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(400)                     = 0x804b280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(500)                     = 0x804b418</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(600)                     = 0x804b610</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(700)                     = 0x804b870</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(800)                     = 0x804bb30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(900)                     = 0x804be58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1000)                    = 0x804c1e0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1100)                    = 0x804c5d0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1200)                    = 0x804ca20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1300)                    = 0x804ced8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hw-&gt;malloc(1400)                    = 0x804d3f0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ exited (status 0) +++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you can see, only one <code>brk</code> call is made.
Furthermore, after the regions are freed they are reused.</p><p><strong>IMPORTANT:</strong> This behaviour of the allocator is important in the <strong>Use After Free</strong> class of vulnerabilities which we will be covering in the next labs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-mappings-and-libraries">Memory Mappings and Libraries<a class="hash-link" href="#memory-mappings-and-libraries" title="Direct link to heading">​</a></h3><p>In our example we had the following memory mappings:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">f7ded000-f7dee000 rw-p 00000000 00:00 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7dee000-f7f93000 r-xp 00000000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7f93000-f7f95000 r--p 001a5000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7f95000-f7f96000 rw-p 001a7000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7f96000-f7f99000 rw-p 00000000 00:00 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7fd9000-f7fdb000 rw-p 00000000 00:00 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7fdb000-f7fdc000 r-xp 00000000 00:00 0                                  [vdso]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7fdc000-f7ffc000 r-xp 00000000 08:06 917869                             /lib32/ld-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7ffc000-f7ffd000 r--p 0001f000 08:06 917869                             /lib32/ld-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f7ffd000-f7ffe000 rw-p 00020000 08:06 917869                             /lib32/ld-2.17.so</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All functions that are called from external libraries <em>pull</em> in the whole library into the address space.
As these are also ELF files you can see that they have similar patterns: multiple sections with different permissions just like the main executable.</p><p>One more thing to note here is that large calls to <code>malloc</code> result in calls to <code>mmap2</code>:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Hello world\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Small allocation %p\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Big allocation %p\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10000000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># strace -e brk,mmap2  ./hw_large</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ Process PID=3445 runs in 32 bit mode. ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0)                                  = 0x804b000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xfffffffff7fda000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 265183, PROT_READ, MAP_PRIVATE, 3, 0) = 0xfffffffff7f99000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 1747628, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xfffffffff7dee000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(0xf7f93000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1a5000) = 0xfffffffff7f93000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(0xf7f96000, 10924, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xfffffffff7f96000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xfffffffff7ded000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xfffffffff7fd9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0)                                  = 0x804b000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0x806e000)                          = 0x806e000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Small allocation 0x804b008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 10002432, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xfffffffff7463000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Big allocation 0xf7463008</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As expected, the <code>brk</code> is increased when the first allocation is made.
However, larger regions are backed by memory mappings.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stack">Stack<a class="hash-link" href="#stack" title="Direct link to heading">​</a></h3><p>If you observed from previous traces, the <code>mmap2</code> call returns addresses towards NULL (lower addresses).
It behaves like this because there is another important memory region called the <code>stack</code> that has a fixed size: usually 8 MB.
Since the heap and the <code>mmap</code> region do not have this limit imposed the optimization is to start mappings from a known boundary: the stack end boundary.
Let&#x27;s put this into perspective.
You can view the current stack limit using <code>ulimit -s</code>.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ulimit -s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8192</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;&gt; hex(0xffffffff - 8192*1024)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;0xff7fffff&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This address is the stack boundary.
It seems odd then that the first <code>mmap</code> in the program above ends at <code>0xf7ffe000</code> and not <code>0xff7fffff</code>.
This is probably an optimization.</p><p>However, we can set the stack size to unlimited and the <code>mmap</code> allocation direction will reverse:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ulimit -s unlimited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ strace -e mmap2,brk ./hw_large</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ Process PID=4617 runs in 32 bit mode. ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0)                                  = 0x804b000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x55578000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 265183, PROT_READ, MAP_PRIVATE, 3, 0) = 0x55579000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 1747628, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x555ba000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(0x5575f000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1a5000) = 0x5575f000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(0x55762000, 10924, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x55762000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x55765000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x55579000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0)                                  = 0x804b000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brk(0x806e000)                          = 0x806e000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Small allocation 0x804b008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmap2(NULL, 10002432, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x55766000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Big allocation 0x55766008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1]+  Stopped                 strace -e mmap2,brk ./hw_large</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cat /proc/4617/maps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048000-08049000 r-xp 00000000 08:06 1843771                            /tmp/hw_large</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049000-0804a000 r--p 00000000 08:06 1843771                            /tmp/hw_large</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a000-0804b000 rw-p 00001000 08:06 1843771                            /tmp/hw_large</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804b000-0806e000 rw-p 00000000 00:00 0                                  [heap]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55555000-55575000 r-xp 00000000 08:06 917869                             /lib32/ld-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55575000-55576000 r--p 0001f000 08:06 917869                             /lib32/ld-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55576000-55577000 rw-p 00020000 08:06 917869                             /lib32/ld-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55577000-55578000 r-xp 00000000 00:00 0                                  [vdso]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55578000-5557a000 rw-p 00000000 00:00 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">555ba000-5575f000 r-xp 00000000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5575f000-55761000 r--p 001a5000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55761000-55762000 rw-p 001a7000 08:06 917808                             /lib32/libc-2.17.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55762000-560f0000 rw-p 00000000 00:00 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fffdd000-ffffe000 rw-p 00000000 00:00 0                                  [stack]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you can see, the big allocation is now towards the stack instead of towards the heap.</p><p>Returning to the main functionality of the stack, remember from the previous lab that local variables are declared on the stack.
This translates into assembly code in the following way:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The C snippet would be translated into ASM something like:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0804840c &lt;main&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 804840c:   55                      push   ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 804840d:   89 e5                   mov    ebp,esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 804840f:   81 ec f0 03 00 00       sub    esp,0x3f0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..........</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>0x3f0</code> hex value is equal to <code>1008</code> in decimal, which is precisely 1000 (from <code>buf</code>) + 4 (from <code>i</code>) + 4 (the storage of another int that the compiler used later in the code).</p><p>As the program subtracts more from <code>esp</code> the kernel will provide pages on-demand until the stack boundary or another <code>mmap</code>-ing is hit.
The kernel will, in this case, kill the application because of the Segmentation Fault.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="segmentation-fault">Segmentation Fault<a class="hash-link" href="#segmentation-fault" title="Direct link to heading">​</a></h3><p>Now that we know everything about the memory address space we can say more about the infamous <code>Segmentation Fault</code> that all of us have, at some time, encountered.
It is basically a permission violation.
Apart from the mappings that appear in <code>/proc/&lt;PID&gt;/maps</code> with <code>r--</code>, <code>rw-</code>, etc, you can consider that everything else is <code>---</code>.
Thus, a read access at such a location will violate the permission of that region so the whole app will be killed by the signal received (unless it has a signal handler).
Examples:</p><ul><li>Dereferencing a <code>NULL</code> pointer will try to read from <code>0x00000000</code> which is not (usually) mapped =&gt; <code>SIGSEGV</code> (read access on none)</li><li>Writing after the end of a heap buffer (if the heap buffer is exactly at the end of a mapping) will determine writes into unmapped pages =&gt; <code>SIGSEGV</code> (write access on none)</li><li>Trying to write to <code>.rodata</code> =&gt; <code>SIGSEGV</code> (write access on read only)</li><li>Overwriting the stack with <code>&quot;AAAAAAAAAAAAAAAAAAA&quot;</code> will also overwrite the return address and make the execution go to <code>0x41414141</code> =&gt; <code>SIGSEGV</code> (execute access on none)</li><li>Overwriting the stack and return address with another address to a shellcode on the stack =&gt; <code>SIGSEGV</code> (execute access on read/write only)</li><li>Trying to rewrite the binary (<code>int *v = main; *v = 0x90909090;</code>) =&gt; <code>SIGSEGV</code> (write access on read/execute only)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tutorials">Tutorials<a class="hash-link" href="#tutorials" title="Direct link to heading">​</a></h2><p>This session is focused on the transformation of an <strong>ELF file</strong> (stored on disk) as it is loaded into memory and becomes <strong>a process</strong> (stored into memory).
We will first analyze the structure of an <strong>ELF file</strong> and how this structure evolves when going from <strong>C source code</strong>, to <strong>object file</strong> and then to either <strong>an executable</strong> or <strong>a shared library</strong>.
We will also skim over how various elements are interpreted by the <strong>linker</strong> and the <strong>loader</strong>.
Finally, we will see the layout of a process once it is loaded into memory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="big-picture-view">Big Picture View<a class="hash-link" href="#big-picture-view" title="Direct link to heading">​</a></h3><p>Sun Microsystems&#x27; SunOS came up with the concept of dynamic shared libraries and introduced it to UNIX in the late 1980s.
UNIX System V Release 4, which Sun co-developed, introduced the ELF object format adaptation from the Sun scheme.
Later it was developed and published as part of the <code>ABI</code> (<em>Application Binary Interface</em>) as an improvement over <code>COFF</code>, the previous object format and by the late 1990s it had become the standard for UNIX and UNIX-like systems including Linux and BSD derivatives.
Depending on processor architectures, several specifications have emerged with minor changes, but for this session we will be focusing on the <a href="http://www.skyfree.org/linux/references/ELF_Format.pdf" target="_blank" rel="noopener noreferrer">ELF-32</a> format.</p><p><img loading="lazy" alt="Linking View and Execution View" src="/binary-security/assets/images/elf-link-exec-8c315d546d70d06703327e7e334dd2c8.png" width="400" height="356" class="img_ev3q"></p><p>The structure of an ELF file during the linking process is the same with that of an object file.
The linking process involves collecting and combining code and data into a single file that will later be loaded into memory and executed.
On the right hand side we can see how the the ELF file structure will be transformed in memory.
<strong>Sections</strong> instruct the Linker while <strong>Segments</strong> instruct the Operating System.</p><p><img loading="lazy" alt="ELF Merging" src="/binary-security/assets/images/elf-merging-6ece3911b4622c9e7975d7bd7bce5d1a.png" width="300" height="332" class="img_ev3q"></p><p>As we can see, the information inside the two program headers and the section headers gets merged as needed inside the more familiar program segments.
The basic role of the ELF file format is to serve as a roadmap for the linker and the OS Loader to generate a running process.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="staticdynamic-linking">Static/Dynamic linking<a class="hash-link" href="#staticdynamic-linking" title="Direct link to heading">​</a></h3><p>Out of practical considerations, for very large programs, even early on, it was very impractical to store all of the source code inside a single file.
One of the most mundane of all actions, namely splitting your source code into functions across multiple files while still obtaining a valid running program was a difficult engineering challenge.
The initial paradigm was called <strong>static linking</strong> and was the only option inside the <code>COFF</code> file format.
It involves interpreting each piece of code from each file and then merging all the information inside a single binary that would contain all the machine code necessary for the program.
This way of doing things, still in use today, involves loading all of the code and data into memory regardless of use case.
This basically meant that, the required resources to run a program were determined by the number of instances, with no possibility of optimization.
Running 10 instances of the same program meant that there was a lot of code duplication going on in the memory space.</p><p><img loading="lazy" alt="ELF Static Linking" src="/binary-security/assets/images/elf-static-linking-61fa4e6e953d672ae8386a7bdc564d28.png" width="500" height="262" class="img_ev3q"></p><p>Along with the ELF format came a new way of doing things.
Instead of linking all the source files that contained subroutines into the final binaries, separate binaries were organized in libraries that could be loaded per use case, on demand.
Essentially, the libraries were loaded only once into memory and when a program instance required a subroutine from a specific library it would inquire a special OS component about it and new resources would be allocated only for the volatile parts of the library image (<code>.bss</code> and <code>.data</code>).
The new process allowed for a much more efficient resource utilization and was named dynamic linking and the new type of library files were called shared objects.
Running 10 instances of the same program now meant that only the volatile parts of those binaries would be duplicated.
In cases where the same code can be reused, it is allocated only once and used by multiple instances of the same program.</p><p><img loading="lazy" alt="ELF Dynamic Linking" src="/binary-security/assets/images/elf-dynamic-linking-e002782e7ca43fdc948775a40e6f4400.png" width="500" height="283" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="elf-types">ELF Types<a class="hash-link" href="#elf-types" title="Direct link to heading">​</a></h3><p>There are several ELF types but the most common types we will be dealing with are:</p><ul><li>Relocatable Files</li><li>Shared Objects</li><li>Executable Files</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="elf-type---relocatable-files">ELF Type - Relocatable Files<a class="hash-link" href="#elf-type---relocatable-files" title="Direct link to heading">​</a></h4><p>Relocatable files are obtained using the core compiler and basically contain all the ELF information necessary except for data like external variables or subroutines that are present in other files.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -o reloc.o source.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -fPIC -o reloc.o source.c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first command will produce a relocatable file that will later constitute an executable or a static library.
If we want to use the relocatable file to later create a shared library we need to use the second variant to create a relocatable file that has <a href="https://wiki.gentoo.org/wiki/Hardened/Introduction_to_Position_Independent_Code" target="_blank" rel="noopener noreferrer">Position Independent Code</a> (PIC).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="elf-type---shared-objects">ELF Type - Shared Objects<a class="hash-link" href="#elf-type---shared-objects" title="Direct link to heading">​</a></h4><p>Shared libraries are loaded up at runtime as needed by an OS component named the dynamic loader.
Shared objects may include other shared objects and this aspect is very important because, when loading specific subroutines, the ELF file must provide its dependencies.
As such, the process of dynamic linking does a breadth first search gradually building the full dependency list.</p><p><img loading="lazy" alt="Shared Objects" src="/binary-security/assets/images/elf-dependency-dd5b7e5505ce86cb6fa3af17d55db1c4.png" width="500" height="308" class="img_ev3q"></p><p>You can view the list of shared object dependencies for any given binary as well as the addresses where they will be loaded in memory by using the <code>ldd</code> command.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ldd /bin/ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    linux-gate.so.1 =&gt;  (0x00e02000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0x004f9000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    libselinux.so.1 =&gt; /lib/libselinux.so.1 (0x00c62000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    libacl.so.1 =&gt; /lib/libacl.so.1 (0x00a87000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0x00110000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0x00325000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /lib/ld-linux.so.2 (0x00a45000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0x0077d000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    libattr.so.1 =&gt; /lib/libattr.so.1 (0x00dd7000)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All libraries should adhere to a strict naming convention.
Shared objects have two names:</p><ul><li><strong><code>soname</code></strong> - that consists of the prefix <code>lib</code>, followed by the library name, then a <code>.so</code>, another dot, then the major version (e.g. <code>libtest.so.1</code>)</li><li><strong>real name</strong> - is actually a filename, that usually extends the <code>soname</code> by adding a dot and minor version number along with the release version (e.g. <code>libtest.so.1.23.3</code>)</li></ul><p>Additionally, each library source file should have an accompanying header file with the extension <code>.h</code> and the same name.</p><p>Adhering to these naming conventions is quite important as dependencies are resolved based on the <code>soname</code>.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -fPIC libtesting.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ld -shared -soname libtesting.so.1 -o libtesting.so.1.0 -lc libtesting.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig -v -n .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -sf libtesting.so.1 libtesting.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export LD_LIBRARY_PATH=.:&quot;$LD_LIBRARY_PATH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -o main_program main_program.c -L. -ltesting</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first line creates an object file with position independent code.
The second line will create the shared object with <code>soname</code> <code>libtesting.so.1</code> and a real filename of <code>libtesting.so.1.0</code> by using the linker.
Shared objects are usually installed in other directories but the line containing <code>ldconfig</code>, will install it in the current directory.
At runtime the standard directories like <code>/usr/lib</code> are searched, but we add the local directory to the search path by modifying the <code>LD_LIBRARY_PATH</code> environment variable.</p><p>Finally, the executable is created by dynamic linking against the shared object.</p><p>A good tutorial on how to create a basic shared object can be found <a href="https://www.ibm.com/developerworks/library/l-shobj/" target="_blank" rel="noopener noreferrer">here</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="elf-type---executable-files">ELF Type - Executable Files<a class="hash-link" href="#elf-type---executable-files" title="Direct link to heading">​</a></h4><p>They are regarded as the end result and contain all the information necessary to create a running process.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="elf-structure">ELF Structure<a class="hash-link" href="#elf-structure" title="Direct link to heading">​</a></h3><p>The following wiki sections on ELF structure are dense and are <strong>not</strong> meant to be known by heart.
<strong>Do not</strong> try to read them all at once and memorize them, but rather use the following chapters as <strong>reference</strong>.</p><p>Tools of the trade are:</p><ul><li><code>readelf</code></li><li><code>objdump</code></li><li><code>ldd</code></li><li>Ghidra/IDA (Ghidra is Open Source, while IDA is not and it is really expensive)</li></ul><p>The command outputs that follow are rather large so we will only be discussing the less obvious parts.
We will also leave out information that&#x27;s not really that important or generally weird.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="elf-header">ELF Header<a class="hash-link" href="#elf-header" title="Direct link to heading">​</a></h4><p>Using <code>readelf</code> is straight-forward enough:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">readelf -h program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ELF Header:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Class:                             ELF32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Data:                              2&#x27;s complement, little endian</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version:                           1 (current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OS/ABI:                            UNIX - System V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ABI Version:                       0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type:                              EXEC (Executable file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Machine:                           Intel 80386</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version:                           0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Entry point address:               0x8048330</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Start of program headers:          52 (bytes into file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Start of section headers:          4392 (bytes into file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Flags:                             0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size of this header:               52 (bytes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size of program headers:           32 (bytes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Number of program headers:         8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size of section headers:           40 (bytes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Number of section headers:         30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Section header string table index: 27</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Below we will discuss the less evident aspects of the above output</p><ul><li><strong>Elf Identification</strong> (16 bytes)<ul><li><strong>Magic</strong> - the first bytes of the binary that identify the file as ELF</li><li><strong>Class</strong> - identifies the type of ELF (ex: ELF-32, ELF-64)</li><li><strong>Data</strong> - specifies the type of data encoding</li><li><strong>Version</strong> - version of the ELF header</li><li><strong>OS/ABI</strong> - version of the OS</li><li><strong>ABI</strong> - version of the ABI specification</li></ul></li><li><strong>Type</strong> - Relocatable, Executable, Shared Object</li><li><strong>Machine</strong> - Required Machine architecture to run the executable</li><li><strong>Entry Point Address</strong> - the memory address where the OS loader transfers control to the process code for the first time.</li><li><strong>Start of Program Headers</strong> - File offset where the array of program headers start</li><li><strong>Start of Section Headers</strong> - File offset where the array of section headers starts</li><li><strong>Section Header String Table Index</strong> - the index in the section table name where the information about the section name string table can be found</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="program-headers">Program Headers<a class="hash-link" href="#program-headers" title="Direct link to heading">​</a></h4><p><strong>Program Headers</strong> are only present inside <strong>Executable</strong> and <strong>Shared Object</strong> files.</p><p>Again, <code>readelf</code> is used with minimum syntax:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ readelf -l program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Elf file type is EXEC (Executable file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Entry point 0x8048330</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There are 8 program headers, starting at offset 52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Program Headers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PHDR           0x000034 0x08048034 0x08048034 0x00100 0x00100 R E 0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  INTERP         0x000134 0x08048134 0x08048134 0x00013 0x00013 R   0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      [Requesting program interpreter: /lib/ld-linux.so.2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LOAD           0x000000 0x08048000 0x08048000 0x004e4 0x004e4 R E 0x1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LOAD           0x000f0c 0x08049f0c 0x08049f0c 0x00108 0x00110 RW  0x1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DYNAMIC        0x000f20 0x08049f20 0x08049f20 0x000d0 0x000d0 RW  0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NOTE           0x000148 0x08048148 0x08048148 0x00044 0x00044 R   0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GNU_RELRO      0x000f0c 0x08049f0c 0x08049f0c 0x000f4 0x000f4 R   0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Section to Segment mapping:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Segment Sections...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   01     .interp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   02     .interp .note.ABI-tag .note.gnu.build-id .hash .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .text .fini .rodata .eh_frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   03     .ctors .dtors .jcr .dynamic .got .got.plt .data .bss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   04     .dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   05     .note.ABI-tag .note.gnu.build-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   06</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   07     .ctors .dtors .jcr .dynamic .got</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <strong>Program Header</strong> table features an array of structures that shows how parts of the file will be mapped into memory at runtime.
The last parts of the output show what sections will be merged into various program headers before loading the ELF into memory and becoming segments.</p><ul><li><code>Type</code><ul><li><code>PHDR</code> - information about the program header table itself</li><li><code>INTERP</code> - information about the null terminated string that specifies the path to the dynamic loader.
This header is only present in executable that use shared object code</li><li><code>LOAD</code> - use to specify a general purpose loadable segment</li><li><code>DYNAMIC</code> - information necessary to the dynamic linking process</li></ul></li><li><code>Offset</code> - offset from the beginning of the file where the segment begins</li><li><code>VirtAddr</code> - the address where the segment will start in memory</li><li><code>FileSz</code> - number of bytes occupied by the segment on disk</li><li><code>MemSiz</code> - number of bytes occupied by the segment in memory</li><li><code>Align</code> - specifies a boundary to which the segments are aligned on file and in memory</li></ul><p>Here are two resources to read about <a href="https://www.airs.com/blog/archives/189" target="_blank" rel="noopener noreferrer"><code>GNU_RELRO</code></a> and <a href="https://guru.multimedia.cx/pt_gnu_stack/" target="_blank" rel="noopener noreferrer"><code>GNU_STACK</code></a> <strong>Program Headers</strong>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="section-table">Section Table<a class="hash-link" href="#section-table" title="Direct link to heading">​</a></h4><p>Section headers are the central piece of reference used to organize the ELF files both on disk and in memory.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">readelf -S program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There are 30 section headers, starting at offset 0x1128:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Section Headers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 1] .interp           PROGBITS        08048134 000134 000013 00   A  0   0  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 2] .note.ABI-tag     NOTE            08048148 000148 000020 00   A  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 3] .note.gnu.build-i NOTE            08048168 000168 000024 00   A  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 4] .hash             HASH            0804818c 00018c 000028 04   A  6   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 5] .gnu.hash         GNU_HASH        080481b4 0001b4 000020 04   A  6   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 6] .dynsym           DYNSYM          080481d4 0001d4 000050 10   A  7   1  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 7] .dynstr           STRTAB          08048224 000224 00004c 00   A  0   0  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 8] .gnu.version      VERSYM          08048270 000270 00000a 02   A  6   0  2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 9] .gnu.version_r    VERNEED         0804827c 00027c 000020 00   A  7   1  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [10] .rel.dyn          REL             0804829c 00029c 000008 08   A  6   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [11] .rel.plt          REL             080482a4 0002a4 000018 08   A  6  13  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [12] .init             PROGBITS        080482bc 0002bc 000030 00  AX  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [13] .plt              PROGBITS        080482ec 0002ec 000040 04  AX  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [14] .text             PROGBITS        08048330 000330 00017c 00  AX  0   0 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [15] .fini             PROGBITS        080484ac 0004ac 00001c 00  AX  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [16] .rodata           PROGBITS        080484c8 0004c8 000015 00   A  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [17] .eh_frame         PROGBITS        080484e0 0004e0 000004 00   A  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [18] .ctors            PROGBITS        08049f0c 000f0c 000008 00  WA  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [19] .dtors            PROGBITS        08049f14 000f14 000008 00  WA  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [20] .jcr              PROGBITS        08049f1c 000f1c 000004 00  WA  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [21] .dynamic          DYNAMIC         08049f20 000f20 0000d0 08  WA  7   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [22] .got              PROGBITS        08049ff0 000ff0 000004 04  WA  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [23] .got.plt          PROGBITS        08049ff4 000ff4 000018 04  WA  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [24] .data             PROGBITS        0804a00c 00100c 000008 00  WA  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [25] .bss              NOBITS          0804a014 001014 000008 00  WA  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [26] .comment          PROGBITS        00000000 001014 000023 01  MS  0   0  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [27] .shstrtab         STRTAB          00000000 001037 0000ee 00      0   0  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [28] .symtab           SYMTAB          00000000 0015d8 000410 10     29  45  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [29] .strtab           STRTAB          00000000 0019e8 0001fd 00      0   0  1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>Name</code> - is obtained by reading the value of the section names table at the specified index</li><li><code>Type</code><ul><li><code>PROGBITS</code> - information that is given meaning by the program when loaded into memory</li><li><code>NOBITS</code> - similar to <code>PROGBITS</code> in meaning but occupies no space in the file</li><li><code>STRTAB</code> - contains the program string table</li><li><code>SYMTAB</code> - contains the symbol table</li><li><code>DYNAMIC</code> - holds information necessary for dynamic linking</li><li><code>DYNSYM</code> - holds a set of symbols used in the dynamic linking process</li><li><code>REL</code> - holds relocation entries</li></ul></li><li><code>Addr</code> - if the section is part of an executable it will hold the virtual address where the section could be found in memory.
If not it would be 0.</li><li><code>Off</code> - offset from the beginning of the file to where the section starts</li><li><code>Size</code> - size of the section in bytes</li><li><code>ES</code> - size in bytes per entry, if fixed entry size is used</li><li><code>FLG</code></li><li><code>X</code> - contains executable code</li><li><code>W</code> - contains writable code</li><li><code>A</code> - will be loaded into memory as-is during process execution</li><li><code>Al</code> - section alignment constraints</li></ul><p>The <code>Inf</code> and <code>Lnk</code> columns have specific interpretations depending on the section type, as can be seen in the following image:</p><p><img loading="lazy" alt="ELF Sections Inf and Lnk" src="/binary-security/assets/images/elf-sect-inf-dd7154e2e44a3d8a41c94c731bfd0c46.png" width="500" height="282" class="img_ev3q"></p><p>Additionally, the raw contents of each section can be dumped using both <code>objdump</code> and <code>readelf</code>.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">readelf -x .got program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hex dump of section &#x27;.got&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0x08049ff0 00000000                            ....</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objdump -s -j &quot;.got&quot;  program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">program:     file format elf32-i386</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Contents of section .got:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 8049ff0 00000000                             ....</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For more details about the kind of data stored by ELF sections, refer to this <a href="https://refspecs.linuxfoundation.org/LSB_3.0.0/LSB-Core-generic/LSB-Core-generic/specialsections.html" target="_blank" rel="noopener noreferrer">resource</a>.</p><p>When trying to dump contents of section using <code>readelf</code> you can interpret the output like strings by using the <code>-p</code> flag.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="symbol-table">Symbol Table<a class="hash-link" href="#symbol-table" title="Direct link to heading">​</a></h4><p>One of the initial goals of the ELF format was to enable dynamic linking.
Given the machine code of a binary, various elements inside it will use absolute addresses that are based on the memory address where the binary expects to be loaded.
The entire idea of shared libraries is that these can be loaded and unloaded on demand inside the memory space of whichever process needs them at whichever address is available.
As such, a map of how to locate and relocate absolute data points inside the machine code is needed and that&#x27;s where the symbol table comes in.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">readelf -s libtesting.so.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Symbol table &#x27;.dynsym&#x27; contains 8 entries:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1: 00001339     1 OBJECT  GLOBAL DEFAULT   12 cPub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2: 000001f8    10 FUNC    GLOBAL DEFAULT    7 fPub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     3: 0000020c   100 FUNC    GLOBAL DEFAULT    7 foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4: 00001328    16 OBJECT  GLOBAL DEFAULT   11 a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     5: 00001338     0 NOTYPE  GLOBAL DEFAULT  ABS __bss_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     6: 0000133c     0 NOTYPE  GLOBAL DEFAULT  ABS _end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     7: 00001338     0 NOTYPE  GLOBAL DEFAULT  ABS _edata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Symbol table &#x27;.symtab&#x27; contains 27 entries:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1: 000000b4     0 SECTION LOCAL  DEFAULT    1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2: 000000e8     0 SECTION LOCAL  DEFAULT    2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     3: 00000168     0 SECTION LOCAL  DEFAULT    3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4: 000001a8     0 SECTION LOCAL  DEFAULT    4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     5: 000001d0     0 SECTION LOCAL  DEFAULT    5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     6: 000001d8     0 SECTION LOCAL  DEFAULT    6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     7: 000001f8     0 SECTION LOCAL  DEFAULT    7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     8: 00001274     0 SECTION LOCAL  DEFAULT    8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     9: 00001314     0 SECTION LOCAL  DEFAULT    9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10: 00001318     0 SECTION LOCAL  DEFAULT   10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    11: 00001328     0 SECTION LOCAL  DEFAULT   11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    12: 00001338     0 SECTION LOCAL  DEFAULT   12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    13: 00000000     0 SECTION LOCAL  DEFAULT   13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    14: 00000000     0 FILE    LOCAL  DEFAULT  ABS libtesting.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15: 00000202    10 FUNC    LOCAL  DEFAULT    7 fLocal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    16: 00001338     1 OBJECT  LOCAL  DEFAULT   12 cLocal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    17: 00001318     0 OBJECT  LOCAL  HIDDEN  ABS _GLOBAL_OFFSET_TABLE_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    18: 00000270     0 FUNC    LOCAL  HIDDEN    7 __i686.get_pc_thunk.bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    19: 00001274     0 OBJECT  LOCAL  HIDDEN  ABS _DYNAMIC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    20: 00001339     1 OBJECT  GLOBAL DEFAULT   12 cPub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    21: 000001f8    10 FUNC    GLOBAL DEFAULT    7 fPub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    22: 0000020c   100 FUNC    GLOBAL DEFAULT    7 foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    23: 00001328    16 OBJECT  GLOBAL DEFAULT   11 a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    24: 00001338     0 NOTYPE  GLOBAL DEFAULT  ABS __bss_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    25: 0000133c     0 NOTYPE  GLOBAL DEFAULT  ABS _end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    26: 00001338     0 NOTYPE  GLOBAL DEFAULT  ABS _edata</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Some information on the symbols that may belong to external files or may be referenced by external files during dynamic linking are copied in the <code>.dynsym</code> section.</p><ul><li><code>Name</code> - symbol name</li><li><code>Type</code><ul><li><code>NoType</code> - not specified</li><li><code>FUNC</code> - the symbol influences a function</li><li><code>SECTION</code> - associated with a section</li><li><code>FILE</code> - a symbol that references a files</li></ul></li><li><code>Bind</code><ul><li><code>LOCAL</code> - the symbol information is not visible outside the object file</li><li><code>GLOBAL</code> - the symbol is visible to all the files being combined to form the executable</li></ul></li><li><code>Size</code> - the size of the symbol in bytes or 0 if it is unknown</li><li><code>Ndx</code><ul><li><code>UND</code> - unspecified section reference</li><li><code>COM</code> - unallocated C external variable</li><li><code>ABS</code> - an absolute value for the reference</li><li><code>value</code> - an index into the section table</li></ul></li><li><code>Value</code> - if the symbol table is part of an executable, the value will contain a memory address where the symbol resides.
Otherwise it will contain an offset from the beginning of the section referenced by <code>Ndx</code> or <code>O</code></li></ul><p>As you can see, the symbol table as it appears in object files compiled with gcc is quite verbose, revealing function names and visibility as well as variable scopes, names and even sizes.
In its default form it even shows the name of the source file.</p><p>In order to subvert Reverse Engineering attempts you can check out some of the methods of stripping the symbol table of valuable information:</p><ul><li><a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank" rel="noopener noreferrer"><code>A Whirlwind Tutorial on Creating Really Teensy ELF Executables for Linux</code></a></li><li><a href="https://sourceware.org/binutils/docs/binutils/strip.html" target="_blank" rel="noopener noreferrer"><code>strip</code></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="relocations">Relocations<a class="hash-link" href="#relocations" title="Direct link to heading">​</a></h4><p>Relocations were a concept that was present ever since the invention of static linking.
The initial purpose of relocations was to give the static linker a roadmap when combining multiple object files into a binary by stating:</p><ul><li>The <strong>Symbol</strong> that needs to be fixed.</li><li><strong>Where</strong> you can find the symbol (file/section offset).</li><li>An <strong>Algorithm</strong> for making the fixes.</li></ul><p>The fixes would usually be made in the <code>.data</code> and <code>.text</code> sections and everything was well.
Dynamic runtime brought a bit of a complication to modifications that needed to be made in the code segments.
The whole idea of shared libraries is that the code can be loaded once into memory from an ELF file then shared among all the processes that use the library.
The only way to reliably do this is to make the code section read-only.</p><p>In order to compensate for this constraint a special data section called the <code>GOT</code> (<em>Global Offset Table</em>) was created.
When the code needs to work with a symbol that belongs to shared object, in the code entry for that symbol uses addresses from the <code>GOT</code> table.
First time the symbol is referenced the dynamic linker corrects the entry in <code>GOT</code> and on subsequent calls the correct address will be used.</p><p>When implementing calls to subroutines in shared objects, a different table is used called the <code>PLT</code> (<em>Procedure Linkage Table</em>).
The initial call is made to a stub sequence in the <code>PLT</code> which bounces off a <code>GOT</code> entry in order to push the subroutine name on the stack and then calls the resolver (mentioned in the <code>INTERP</code> program header).</p><p>Relocations and how they get applied are very complex topic and we will only try to cover as far is helps detecting file and symbol types If you want to read more you can refer to some of these resources:</p><ul><li><a href="http://www.mindfruit.co.uk/2012/06/relocations-relocations.html" target="_blank" rel="noopener noreferrer"><code>Some Assembly Required</code></a></li><li><a href="http://netwinder.osuosl.org/users/p/patb/public_html/elf_relocs.html" target="_blank" rel="noopener noreferrer"><code>Study Of ELF Loading and Relocs</code></a></li></ul><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">readelf -r libdynamic.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Relocation section &#x27;.rel.text&#x27; at offset 0x5f8 contains 8 entries:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Offset     Info    Type            Sym.Value  Sym. Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000001d  00001402 R_386_PC32        00000000   __i686.get_pc_thunk.bx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000023  0000150a R_386_GOTPC       00000000   _GLOBAL_OFFSET_TABLE_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000029  00000409 R_386_GOTOFF      00000000   .bss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000002f  00000409 R_386_GOTOFF      00000000   .bss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000035  00000d03 R_386_GOT32       00000004   so_int_global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000041  00000d03 R_386_GOT32       00000004   so_int_global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000052  00000e04 R_386_PLT32       00000000   so_fpublic_global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000005b  00000209 R_386_GOTOFF      00000000   .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Relocation section &#x27;.rel.data.rel.local&#x27; at offset 0x638 contains 2 entries:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Offset     Info    Type            Sym.Value  Sym. Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000  00000401 R_386_32          00000000   .bss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000004  00000201 R_386_32          00000000   .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Relocation section &#x27;.rel.data.rel&#x27; at offset 0x648 contains 2 entries:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Offset     Info    Type            Sym.Value  Sym. Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000  00000d01 R_386_32          00000004   so_int_global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000004  00000e01 R_386_32          00000000   so_fpublic_global</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>Offset</code> - In relocatable files and linked shared objects it contains the offset from the beginning of the section , where the relocation needs to be applied</li><li><code>Info</code> - This field is used to derive the index in the symbol table to the affected symbol as well as the algorithm needed for fixing.<ul><li><code>info &gt;&gt; 8</code> - symbol table index</li><li><code>info &amp; 0xff</code> - algorithm type as defined in the documentation</li></ul></li></ul><p><code>readelf</code> is nice enough to interpret the symbol table for us and gives us the relocation algorithm in the <code>Type</code> field and also the symbol name and value as defined in the symbol table.</p><p>By looking at the types of relocations we can draw some basic conclusions about the symbol types and also about the files.</p><ul><li>Relocatable Files<ul><li><code>R_386_32</code> - usually used to reference changes to a local symbol</li><li><code>R_386_PC32</code> - reference a relative distance from here to the symbol</li></ul></li><li>Relocatable Files for Shared object<ul><li><code>R_386_GOTOFF</code> - usually found in the code area, describes the offset from the beginning of <code>GOT</code> to a local symbol</li><li><code>R_386_GOT32</code> - also specific to the code area.
These entries persist in the linkage phase</li><li><code>R_386_PLT32</code> - used when describing calls to global subroutines.
when the linker will read this information it will generate an entry in the <code>GOT</code> and <code>PLT</code> tables</li><li><code>R_386_GOTPC</code> - used in function to calculate the start address of the <code>GOT</code></li></ul></li><li>Executables that use Dynamic Linking<ul><li><code>R_386_JMP</code> - the dynamic linker will deposit the address of the external subroutine during execution</li><li><code>R_386_COPY</code> - the address of global variable from shared object will be deposited here</li></ul></li><li>Shared Object Files<ul><li><code>R_386_JMP</code> - the dynamic linker will deposit the address of the external subroutine from one of the shared object dependencies during execution</li><li><code>R_386_GLOB_DATA</code> - used to deposit the address of a global symbol defined in one of the shared object dependencies</li><li><code>R_386_RELATIVE</code> - at link time all the <code>R_386_GOTOFF</code> entries are fixed and these relocation will contain absolute addresses</li></ul></li></ul><p><strong>IMPORTANT:</strong> Executable files that are statically linked do not contain relocations.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="challenges">Challenges<a class="hash-link" href="#challenges" title="Direct link to heading">​</a></h2><p>Challenges can be found in the <code>activities/</code> directory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="01-binary-puzzle">01. Binary Puzzle<a class="hash-link" href="#01-binary-puzzle" title="Direct link to heading">​</a></h3><p>Now that you know some stuff let&#x27;s see how fast you can solve a 4 piece puzzle!</p><p>You are given 4 relocatable object files.
Examine their structure carefully and figure out what each of them is meant to be and how you can link them to create a valid binary.</p><p>All conventions regarding shared object names have been respected.</p><p>Hints:</p><ul><li>Use <code>nm</code> to investigate the files, determine what pieces you need to put together and then link them with <code>gcc</code>.</li><li>Check whether the files are compiled for 32 bits or for 64 bits and use the proper <code>gcc</code> command.</li></ul><p>If you do it correctly you will get an executable that you can run and get the following output:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Congratulations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extern var1 10 at 0x565fe020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extern var2  at 0x565fe030</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extern var3 99 at 0x565fe024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local var4 0 at 0xffd532ac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g(): not really external</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="02-case-of-the-missing-function">02. Case of the Missing Function<a class="hash-link" href="#02-case-of-the-missing-function" title="Direct link to heading">​</a></h3><p>This task contains a helpless little binary that has lost one of its functions.
Analyze the symbol dependencies as well as the code inside the binary.
Figure out a way to reunite the binary with its missing function.</p><p>You cannot modify any of the binaries in order to solve this task.</p><p>Hints:</p><ul><li>Run the file, check what it is missing and build the missing component.
Use <code>nm</code> to determine what symbols should be part of the missing component.</li><li>Use <code>LD_LIBRARY_PATH=.</code> to run an executable file and load a shared library file from the current folder.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="03-memory-dump-analysis">03. Memory Dump Analysis<a class="hash-link" href="#03-memory-dump-analysis" title="Direct link to heading">​</a></h3><p>Using your newfound voodoo skills you are now able to tackle the following task.
In the middle of two programs I added the following lines:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%p\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The results were the following, respectively:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0x804853b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x8048530</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xf7e0ace5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffce64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffce6c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xf7ffcfc0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x1c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xf7fda4c8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffce60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xf7f94e54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xd545cf8d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0xbfffe7d0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xd696910</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x80484a9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb7fffbe8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb7ffefc0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb7df6a84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb7fdc780</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb7fe75fc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x804c008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb7e59195</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x804c008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb7fdb000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xb7fdc000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffffff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xf3b9a5b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Try to tell:</p><ul><li>Which was running on a pure 32 bit system?</li><li>Which values from the stack traces are from the <code>.text</code> region?</li><li>Which do not point to valid memory addresses?</li><li>Which point to the stack?</li><li>Which point to the library/<code>mmap</code> zone?</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="04-compiler-flags">04. Compiler Flags<a class="hash-link" href="#04-compiler-flags" title="Direct link to heading">​</a></h3><p>Use proper compiler/linker flags/options to create a running executable for <code>flag1.o</code> and <code>caller.c</code> and for <code>flag2.o</code> and <code>caller.c</code>.
Submit the flag <a href="https://sss-ctf.security.cs.pub.ro/challenges" target="_blank" rel="noopener noreferrer">on the platform</a>.</p><p>It&#x27;s the same flag, it&#x27;s just to make sure you are able to find the flag with both formats of the <code>flag*.o</code> object files.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="05-print-flag">05. Print Flag<a class="hash-link" href="#05-print-flag" title="Direct link to heading">​</a></h3><p>Someone has tampered with the executable file <code>get_message</code>.
Please fix this.
There should be a flag message printed in case you solve it correctly.</p><p>You will need to modify the executable.
We recommend you install and use <a href="https://packages.ubuntu.com/bionic/bless" target="_blank" rel="noopener noreferrer">Bless</a>.</p><p>What actions does the program do?
What functions does it invoke?
What should it invoke?</p><p>Follow the actions from the entry point in the ELF file and see what is the spot where the program doesn&#x27;t do what it should.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="06-matryoshka">06. <code>matryoshka</code><a class="hash-link" href="#06-matryoshka" title="Direct link to heading">​</a></h3><p>Look carefully inside the <code>matryoshka</code> executable.
The flag is there, but inside something else.</p><p>Submit the flag <a href="https://sss-ctf.security.cs.pub.ro/challenges" target="_blank" rel="noopener noreferrer">on the platform</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bonus-07-fix-me">Bonus: 07. Fix Me<a class="hash-link" href="#bonus-07-fix-me" title="Direct link to heading">​</a></h3><p>You are given a binary that was stored on a USB stick in space where it was hit by gamma rays thus altering its content.
Fortunately, because the executable is so small, the only area damaged is the ELF header.
Fix it and run it!</p><p>The structure of an ELF file is briefly presented <a href="http://i.imgur.com/m6kL4Lv.png" target="_blank" rel="noopener noreferrer">here</a></p><p>A more detailed explanation of the ELF header is presented <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format#Program_header" target="_blank" rel="noopener noreferrer">here</a></p><p>The entry point address should be <code>0x8048054</code>.</p><p>Review <a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank" rel="noopener noreferrer">this tutorial</a> on creating a minimal ELF file.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="further-pwning">Further Pwning<a class="hash-link" href="#further-pwning" title="Direct link to heading">​</a></h3><p><a href="http://crackmes.cf/users/geyslan/crackme.02.32/" target="_blank" rel="noopener noreferrer">This</a> is a challenge that will test your knowledge from the first three sessions.
The password for the archive is <code>crackmes.de</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="further-reading">Further Reading<a class="hash-link" href="#further-reading" title="Direct link to heading">​</a></h3><ul><li><a href="http://www.skyfree.org/linux/references/ELF_Format.pdf" target="_blank" rel="noopener noreferrer">ELF-32</a></li><li><a href="http://ftp.openwatcom.org/devel/docs/elf-64-gen.pdf" target="_blank" rel="noopener noreferrer">ELF-64</a> specification</li><li><a href="https://elinux.org/Executable_and_Linkable_Format_(ELF)" target="_blank" rel="noopener noreferrer">list</a> of all ELF specification formats</li><li><a href="https://developer.arm.com/documentation/ihi0044/e/" target="_blank" rel="noopener noreferrer">ARM</a> specification</li><li><a href="https://wiki.gentoo.org/wiki/Hardened/Introduction_to_Position_Independent_Code" target="_blank" rel="noopener noreferrer">Position Independent Code</a></li><li><a href="https://www.ibm.com/developerworks/library/l-shobj/" target="_blank" rel="noopener noreferrer">Creating shared objects</a></li><li><a href="https://www.airs.com/blog/archives/189" target="_blank" rel="noopener noreferrer"><code>GNU_RELRO</code></a></li><li><a href="https://guru.multimedia.cx/pt_gnu_stack/" target="_blank" rel="noopener noreferrer"><code>GNU_STACK</code></a></li><li><a href="https://refspecs.linuxfoundation.org/LSB_3.0.0/LSB-Core-generic/LSB-Core-generic/specialsections.html" target="_blank" rel="noopener noreferrer">ELF Special Sections</a></li><li><a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank" rel="noopener noreferrer"><code>A Whirlwind Tutorial on Creating Really Teensy ELF Executables for Linux</code></a></li><li><a href="https://sourceware.org/binutils/docs/binutils/strip.html" target="_blank" rel="noopener noreferrer"><code>strip</code> man page</a></li><li><a href="http://www.mindfruit.co.uk/2012/06/relocations-relocations.html" target="_blank" rel="noopener noreferrer">Some Assembly Required</a></li><li><a href="http://netwinder.osuosl.org/users/p/patb/public_html/elf_relocs.html" target="_blank" rel="noopener noreferrer"><code>Study Of ELF Loading and Relocs</code></a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/binary-security/Binary Analysis/Executables and Processes/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Executables and Processes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/binary-security/Binary Analysis/Executables and Processes/Drills/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Drills</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#process-memory-layout" class="table-of-contents__link toc-highlight">Process Memory Layout</a><ul><li><a href="#executable" class="table-of-contents__link toc-highlight">Executable</a></li><li><a href="#heap" class="table-of-contents__link toc-highlight">Heap</a></li><li><a href="#memory-mappings-and-libraries" class="table-of-contents__link toc-highlight">Memory Mappings and Libraries</a></li><li><a href="#stack" class="table-of-contents__link toc-highlight">Stack</a></li><li><a href="#segmentation-fault" class="table-of-contents__link toc-highlight">Segmentation Fault</a></li></ul></li><li><a href="#tutorials" class="table-of-contents__link toc-highlight">Tutorials</a><ul><li><a href="#big-picture-view" class="table-of-contents__link toc-highlight">Big Picture View</a></li><li><a href="#staticdynamic-linking" class="table-of-contents__link toc-highlight">Static/Dynamic linking</a></li><li><a href="#elf-types" class="table-of-contents__link toc-highlight">ELF Types</a></li><li><a href="#elf-structure" class="table-of-contents__link toc-highlight">ELF Structure</a></li></ul></li><li><a href="#challenges" class="table-of-contents__link toc-highlight">Challenges</a><ul><li><a href="#01-binary-puzzle" class="table-of-contents__link toc-highlight">01. Binary Puzzle</a></li><li><a href="#02-case-of-the-missing-function" class="table-of-contents__link toc-highlight">02. Case of the Missing Function</a></li><li><a href="#03-memory-dump-analysis" class="table-of-contents__link toc-highlight">03. Memory Dump Analysis</a></li><li><a href="#04-compiler-flags" class="table-of-contents__link toc-highlight">04. Compiler Flags</a></li><li><a href="#05-print-flag" class="table-of-contents__link toc-highlight">05. Print Flag</a></li><li><a href="#06-matryoshka" class="table-of-contents__link toc-highlight">06. <code>matryoshka</code></a></li><li><a href="#bonus-07-fix-me" class="table-of-contents__link toc-highlight">Bonus: 07. Fix Me</a></li><li><a href="#further-pwning" class="table-of-contents__link toc-highlight">Further Pwning</a></li><li><a href="#further-reading" class="table-of-contents__link toc-highlight">Further Reading</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://security-summer-school.github.io/binary/" target="_blank" rel="noopener noreferrer" class="footer__link-item">site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/SSSUPB/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SSS Team</div></div></div></footer></div>
<script src="/binary-security/assets/js/runtime~main.2a371c1c.js"></script>
<script src="/binary-security/assets/js/main.a3ed9e3a.js"></script>
</body>
</html>