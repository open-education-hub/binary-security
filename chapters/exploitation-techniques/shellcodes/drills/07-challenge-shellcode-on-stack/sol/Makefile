PORT ?= 31345
IMG_NAME ?= challenge07
CONT_NAME ?= $(IMG_NAME)-container

build:
	cd .. && docker build -f src/Dockerfile -t $(IMG_NAME) .

run: stop build
	docker run -d --rm -p $(PORT):31345 --name $(CONT_NAME) -t $(IMG_NAME)
	docker cp $(CONT_NAME):/app/vuln ./vuln

exploit: run
	python3 exploit.py

stop:
	-docker stop $(CONT_NAME) 2>/dev/null || true
	-docker rm -f $(CONT_NAME) 2>/dev/null || true
	-rm -f ./vuln 2>/dev/null || true

clean: stop
	@echo "Cleanup complete"

.PHONY: build run exploit stop clean
